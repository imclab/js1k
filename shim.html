<!doctype html>
<html>
	<head>
		<title>JS1k, 1k demo submission [ID]</title>
		<meta charset="utf-8" />
	</head>
	<body>
		<canvas id="c"></canvas>
		<script>
			var b = document.body;
			var c = document.getElementsByTagName('canvas')[0];
			var a = c.getContext('2d');
			document.body.clientWidth; // fix bug in webkit: http://qfox.nl/weblog/218
		</script>
		<script>
// start of submission //
    function draw() {
      var 	
        sz = 500,
        line = a.getImageData(0, 0, sz, sz),
        xp,
        yp,
        cp,
        cycC = 1000,
        cyc,
        A,
        B,
        C,
        i0 = 0,
        i1 = 1,
        i2 = 0,
        max = 13,
        ra,
        rb,
        x_p,
        ival,
        idx,
        xmp;
      c.setAttribute('width', 500);
      c.setAttribute('height', 500);

      ival = setInterval(function(){
        i0 += 0.002;
        i1 += 0.0005;
        i2 += 0.005;
        var mul = Math.sin(i0) * 4,
        mul2 = Math.cos(i1) * 4,
        mul3 = Math.sin(i1 / 10) * 1;
        max = (Math.sin(3 + i2 * 2) + 1) * 3;
        x_p = sz/(2*max);
        xmp = max * x_p;

        for(A = 0; A < line.data.length; A+=4) {
          line.data[A] *= 0.9;
          line.data[A + 1] *= 0.9;
          line.data[A + 2] *= 0.9;
          line.data[A + 3] = 255;
        }
        var iter = 100;

        while(iter--) {	
          A = C = iter;
          B = 0;
          cyc = cycC;

          while(cyc--) {

            A = (A - C) / (A + mul * B + C);
            B = (A - C) / (B - C);
            C = (A - C) / (A + B + C);

            ra = A * Math.cos(i2) - B * Math.sin(i2);
            rb = A * Math.sin(i2) + B * Math.cos(i2);

            if(ra < max  &&
               ra > -max  &&
               rb < max  &&
               rb > -max ) {	
              
              xp = Math.floor(xmp - ra * x_p);
              yp = Math.floor(xmp - rb * x_p);	
              cp = Math.abs(C * 10);
              idx = 4 * (xp * sz + yp);

              line.data[idx] += 30;
              line.data[idx + 1] += 15;
              line.data[idx + 2] += cp;
            }
          }
        }

        a.putImageData(line, 0, 0);
      }, 10);
    }
    draw();
// end of submission //
		</script>
	</body>
</html>
